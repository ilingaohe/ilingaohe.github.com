---
layout: post
title: "iOS Map学习"
category: 学习笔记
tags: [iOS Map]
---
{% include JB/setup %}

## 学习目的
地图是手机上很重要的一个功能，很多和位置相关的应用都需要用到手机上的地图显示功能，因此我们来了解一下iOS上地图的使用和深入学习地图的特性。

## 具体内容
这部分先来学习iOS上地图的显示、在地图上标记点和在地图上添加覆盖层。

### MKMapView
iOS上的地图使用的是MKMapView，继承自UIView。
可以显示三种类型的地图：街道图、卫星图和混合图。

MKMapViewDelegate是MKMapView的代理，处理MKMapView的回调。

Map Regions是指地图的显示区域，由一个中心点和区域范围决定。
其中中心点的类型为：

	typedef struct {
		CLLocationDegrees latitude;
		CLLocationDegrees longitude;
	} CLLLocationCoordinate2D;
区域范围的类型为：

	typedef struct {
		CLLocationDegrees latitudeDelta;
		CLLocationDegrees longitudeDelta;
	} MKCoordinateSpan;
由这两个组成的地图区域类型为：

	typedef struct {
		CLLocationCoordinate2D center;
		MKCoordinateSpan span;
	} MKCoordinateRegion;

设置地图的区域有两种方式，如果需要改变缩放级别的话，可以设置map region，如果只是移动位置，不改变缩放级别的话，可以只设置centerCoordinate这个地图中心属性。

地图区域（Map Region）有个容易出错的陷阱：因为iOS上的Google Map使用的是墨卡托投影（Mercator Projection，又名等角正轴原著投影）把三维球形的地球变成二维平面的地图，而墨卡托投影的方式是指假设用一个相切的圆柱包围地球，然后从地球的球心向圆柱的面上投影，把地球表面上的图形投影到圆柱体上，再把圆柱体展开成一个二维的平面，就是一幅“墨卡托投影”绘制出的世界地图，如图-1所示：

![墨卡托投影示意图](https://raw.github.com/ilingaohe/ilingaohe.github.com/master/resources/images/2012-09-03-01.png)

图-1 墨卡托投影示意图

但是由图也可以看出墨卡托投影有个缺点，就是投影会产生面积的变形，越靠近两极地区，变形越大，并且到纬度接近两极时，投影会到无穷远。因此实际使用过程中会选择长和宽相等的正方形区域，宽就是地球赤道的周长，为2*PI＊6378137 = 2 * 20037508.3427892，即转换成X ｘ Y坐标表示的范围为[-20037508.3427892,20037508.3427892] *　[-20037508.3427892,20037508.3427892]。
而把长20037508.3427892转换为投影的角度为纬度85.05112877980659，因此X x Y坐标的角度取值为(-180,180) x (-85.05112877980659,85.05112877980659)。图-2为北纬82度和南纬82度之间墨卡托投影产生的地图：
![北纬82度和南纬82度之间墨卡托投影产生的地图](https://raw.github.com/ilingaohe/ilingaohe.github.com/master/resources/images/2012-09-03-02.png)

图-2 北纬82度和南纬82度之间墨卡托投影产生的地图

		